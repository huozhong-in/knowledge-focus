# 产品需求文档

为了帮助不擅长/不愿意整理电脑文件的人，设计一个智能的资源管理器/finder产品。MVP能打动人的点在于对现有、可能杂乱的文件进行智能化的呈现和利用，很快就能获得“让人眼前一亮的文件聚类效果”。

在这个Tauri App中，是三种语言混合使用：TypeScript负责前端界面呈现和相关逻辑，Rust直接跟操作系统打交道，做文件查找和扫描，而Python负责处理数据和跟数据库打交道，也负责跟LLM交流。

## 我们要求用户在macOS和Windows上给读取文件夹的授权，然后监控文件变化，经过筛选、统计、分析后生成对用户有意义的洞察结果，形成一些“文件列表”，每个列表都是一个“智慧文件夹-wise folder”形态，如：

智慧文件夹标题为"最近项目动态：[项目A] 上周有 5 个文档更新"，其列表文件范围只包括7天之内的文件，即在粗筛结果表中选择7天之内的记录
智慧文件夹标题为"本周截图盘点：新增 15 张来自 CleanShot 的截图"，其列表文件范围只包括7天之内的文件，同上
智慧文件夹标题为"文件待办提醒：发现 3 份文件名含‘草稿’的文件超过一个月未修改"，其列表文件范围只包括30天之内的文件，同上
智慧文件夹标题为"清理建议：检测到 4 组文件可能为重复或旧版本"，将粗筛结果表中全部的文件名进行近似对比，这个计算量过重，每30天最多进行一次
智慧文件夹标题为"常用应用文件：本月收到 20 个来自‘微信下载’的文件"，其列表文件范围只包括本月内的文件

# 智慧文件夹-Wise Folder

智慧文件夹是本产品的核心功能之一，通过对文件的聚类分析，为用户提供一种全新的文件组织和浏览方式。类似Excel的视图并不改变原始数据，本App也不改变原始文件在硬盘上的位置，而只是在界面上提供更智能的呈现方式。

## 智慧文件夹概念

类似于Excel中的数据视图，是对原始文件的一种虚拟组织方式：

1. **不改变原始文件位置**：智慧文件夹仅是对文件元数据的引用和显示，不会移动或复制原始文件
2. **基于洞察的聚类**：利用LLM的智力生成洞察(`Insight`)数据，将相关文件组织在一起，所以要严格限制文件范围(通过修改时间判断)，不能每次都把所有文件都纳入统计范围
3. **多维度视角**：提供多种组织维度，如项目关联、内容相似性、使用模式等

## 视图结构

本页面由多个智能文件夹的区块组成，每个智能文件夹包括：
   
1. **标题区**：
   - 显示智慧文件夹标题(`title`)和描述(`description`)
   - 展示智慧文件夹类型(`insight_type`)和优先级(`priority`)标签
   - 提供智慧文件夹相关的统计信息和元数据

2. **文件列表区**：
   - 显示关联文件(`related_files`)，表格首行包括文件名、类型、大小、修改日期
   - 提供文件操作功能，如打开文件、访问原始位置、复制路径等
   - 支持按文件名、大小、日期和类型排序

## 数据来源

智慧文件夹的数据主要来源于数据库的洞察表(`t_insights`)，关键字段包括：

- `title`: 标题，如"最近项目动态"、"本周截图盘点"等
- `description`: 详细描述，如"[项目A] 上周有5个文档更新"
- `insight_type`: 洞察类型，如文件活动、项目更新、清理建议等
- `priority`: 优先级，表示是否应该优先处理
- `related_files`: 相关的文件路径列表，这些文件可能分布在硬盘不同位置
- `score`: 洞察力自评分数，用于排序和筛选和后续衔接系统通知
- `created_at`: 创建时间


# 技术流程设计

当前完整流程设计：
1. 按照Windows和macOS不同罗列常用文件夹，一个个的请求用户给授权
2. Rust的“粗筛”工作
   1. 读取文件元数据(路径、大小、时间戳、计算基本哈希，注意并不读取文件内容)，进行初步规则匹配(如扩展名分类、简单文件名模式等)
   2. 将更结构化的任务信息(包含元数据和初步分类结果)通过Python API入库
   3. 调用Python API通知它可以进行下一步工作，即将后续任务加入队列
   以下三种情况会引发Rust开始工作：
      - 用户再次打开本App
      - 用户变更授权文件夹列表
      - 用户在授权的文件夹中创建、删除、修改文件
3. Python worker 处理更复杂的逻辑(项目识别、高级规则、数据库操作、LLM交互，这个过程我称之为“精炼”)
4. Python worker 在此基础上通过综合分析和挖掘数据生成具有洞察力的结论，即智慧文件夹
5. 如果自评洞察力够高，通过WebSocket推送给前端，前端调用系统通知API，弹出提示框，用户点击后打开App

这是数据流转的四层结构，自下而上数据量快速变小，这个设计的好处有：
- Rust高性能的将频繁变更的文件元数据进行初步规则处理后，传递给Python的任务量大大减少，减少了Python的计算压力。
- Python可以专注于更复杂的逻辑，并通过跟LLM的交互尽量发现对用户有价值的洞察结论。
- 用LLM评估这些洞察结论对用户的吸引力高低，并不是每次有洞察就通知用户，而是精选和控制频率和节奏，不轻易打扰用户。
