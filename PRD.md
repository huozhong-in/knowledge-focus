# 产品需求文档

为了帮助不擅长/不愿意整理电脑文件的人，设计一个智能的资源管理器/finder产品。MVP能打动人的点在于对现有、可能杂乱的文件进行智能化的呈现和利用，很快就能获得“让人眼前一亮的文件聚类效果”。

在这个Tauri App中，是三种语言混合使用：TypeScript负责前端界面呈现和相关逻辑，Rust直接跟操作系统打交道，做文件查找和扫描，而Python负责处理数据和跟数据库打交道，也负责跟LLM交流。

我们要求用户在macOS和Windows上给读取文件/文件夹的授权，然后监控文件变化，以便生成对用户有意义的“洞察”，如：

```
"最近项目动态：[项目A] 上周有 5 个文档更新" (点击可查看文件)
"本周截图盘点：新增 15 张来自 CleanShot 的截图" (点击可管理)
"文件待办提醒：发现 3 份文件名含‘草稿’的文件超过一个月未修改"
"清理建议：检测到 4 组文件可能为重复或旧版本" (点击可对比清理)
"常用应用文件：本月收到 20 个来自‘微信下载’的文件"
```

# 智能视图设计

智能视图是本产品的核心功能之一，通过对文件的聚类分析，为用户提供一种全新的文件组织和浏览方式。类似Excel的视图展示，我们不改变原始文件在硬盘上的位置，而只是在界面上提供更智能的呈现方式。

## 视图概念

智能视图类似于Excel中的数据视图，是对原始文件的一种虚拟组织方式：

1. **不改变原始文件位置**：智能视图仅是对文件的引用，不会移动或复制原始文件
2. **基于洞察的聚类**：利用系统生成的洞察(`Insight`)数据，将相关文件组织在一起
3. **多维度视角**：提供多种组织维度，如项目关联、内容相似性、使用模式等

## 视图结构

智能视图页面主要由以下部分组成：

1. **洞察标题区**：
   - 显示洞察标题(`title`)和描述(`description`)
   - 展示洞察类型(`insight_type`)和优先级(`priority`)标签
   - 提供洞察相关的统计信息和元数据

2. **文件列表区**：
   - 显示关联文件(`related_files`)列表，包括文件名、类型、大小、修改日期等
   - 提供文件操作功能，如打开文件、访问原始位置、复制路径等
   - 支持排序、筛选和分组功能

## 数据来源

智能视图的数据主要来源于数据库的洞察表(`t_insights`)，关键字段包括：

- `title`: 洞察标题，如"最近项目动态"、"本周截图盘点"等
- `description`: 洞察详细描述，如"[项目A] 上周有5个文档更新"
- `insight_type`: 洞察类型，如文件活动、项目更新、清理建议等
- `priority`: 优先级，表示洞察的重要性
- `related_files`: 与洞察相关的文件路径列表，这些文件可能分布在硬盘不同位置
- `score`: 洞察评分，用于排序和筛选
- `created_at`: 洞察创建时间

## 交互设计

1. **视图切换**：
   - 提供多种视图模式：洞察视图、项目视图、分类视图、时间线视图
   - 用户可通过标签切换不同视图模式

2. **文件操作**：
   - 点击文件可打开浏览
   - 上下文菜单提供更多操作：在文件夹中显示、复制路径、查看属性等

3. **视图排序和筛选**：
   - 按文件属性排序：名称、大小、日期等
   - 按洞察类型和优先级筛选
   - 支持搜索和自定义筛选条件

# 技术流程设计

当前完整流程设计：
按照Windows和macOS不同罗列常用文件夹，一个个的请求用户给授权 -> 
Rust 监听这些文件和文件夹，直至拿到元数据变更事件 -> 
Rust 读取文件元数据(路径、大小、时间戳、计算基本哈希)，注意并不读取文件内容 -> 
Rust 进行初步规则匹配(如扩展名分类、简单文件名模式等)，这个过程我称之为“粗筛” -> 
Rust 将更结构化的任务信息(包含元数据和初步分类结果)通过Python API入库 -> 
Rust 调用Python API通知它可以进行下一步工作，即将后续任务加入队列 -> 
Python worker 处理更复杂的逻辑(项目识别、高级规则、数据库操作、LLM交互，这个过程我称之为“精炼”) -> 
Python worker 在此基础上通过综合分析和挖掘数据生成具有“洞察”特性的结论 -> 
通过WebSocket通知前端呈现洞察卡片。

这个设计的好处有：
Rust将可能频繁变更的文件元数据通过初步规则处理后，流转给Python的任务量大大减少，减少了Python的计算压力。
Python可以专注于更复杂的逻辑，并通过跟LLM的交互尽量“发现”对用户有价值的“洞察”结论。
评估这些洞察对用户的吸引力有多大，并不是每次有“洞察”就通知用户，而是精选和控制频率和节奏，做到不打扰用户且让用户感觉眼前一亮。
所以从数据自下而上的数据量来说，文件元数据变更最多，Python处理的任务信息相对较少，洞察生成的结果最少，体现价值但不打扰用户。
